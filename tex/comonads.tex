

\pdfoutput=1

\documentclass{amsart}

\usepackage[protrusion=true,expansion=true]{microtype}

\usepackage{amsmath}

\usepackage[style=numeric,
 maxnames=2,
 maxbibnames=99 ,                
 uniquename=init ,
]{biblatex}
\bibliography{literature.bib}

\usepackage{ownstyle}


\author{nobody}

\title{Comodules over relative comonads}

\newcommand{\fat}[1]{\textbf{#1}}

\begin{document}


\begin{abstract}
  bla bla
\end{abstract}

\maketitle

% \tableofcontents


\begin{definition}[Relative comonad]
  Let $F:\C\to\D$ be a functor. A \fat{relative comonad $T$ over $F$} is given by
  \begin{packitem}
   \item a map $T:\C_0 \to \D_0$ on the objects of the categories involved;
   \item an operation $\counit : \forall c : \C_0, \D(Tc,Fc)$;
   \item an operation $\cobind: \forall c,d:\C_0, \D(Tc,Fd) \to \D(Tc,Td)$
  \end{packitem}
  such that 
  \begin{packitem}
   \item $\forall c,d:\C_0, \forall f:\D(Tc,Fd), \comp{\cobind(f)}{\counit_d} = f$;
   \item $\forall c : \C_0, \cobind(\counit_c) = \id_c$;
   \item $\forall a,b,c:\C_0, \forall f : \D(Ta,Fb),\forall g:\D(Tb,Fc), \\
        \comp{\cobind(f)}{\cobind(g)} = \cobind(\comp{\cobind(f)}{g})$.
  \end{packitem} 
\end{definition}

\begin{example}
  The triangular matrices of \citeauthor{DBLP:conf/types/MatthesP11} \parencite{DBLP:conf/types/MatthesP11} 
  form a relative comonad over the functor from sets to setoids
  associating to any set the setoid together with the equality equivalence relation.
  
  More precisely, let $E$ be an arbitrary fixed type.
   We consider infinite triangular matrices to be given by the following coinductive definition:
  
  \begin{lstlisting}
Coinductive Tri : Set -> Set :=
   head : forall A : Set, Tri (A) -> A.
 | tail : forall A : Set, Tri (A) -> Tri (E x A).
  \end{lstlisting}

  
\end{example}


\begin{definition}[Functoriality for relative comonads]
 For $f : \C(c,d)$ we define
  \[ \lift^T(f) := \cobind(\comp{\counit_c}{Ff}) .  \]
  %TODO: prove functor laws
\end{definition}

\begin{definition}[Comodule over relative comonad]
 Let $T$ be a relative comonad over the functor $F:\C\to\D$, and let $\E$ be a category.
 A \fat{comodule over T} consists of
   \begin{packitem}
   \item a map $:\C_0 \to \E_0$ on the objects of the categories involved;
   \item an operation $\mcobind: \forall c,d:\C_0, \D(Tc,Fd) \to \E(Mc,Md)$
  \end{packitem}
  such that 
  \begin{packitem}
   \item $\forall c : \C_0, \mcobind(\counit_c) = \id_c$;
   \item $\forall a,b,c:\C_0, \forall f : \D(Ta,Fb),\forall g:\D(Tb,Fc), \\
        \comp{\mcobind(f)}{\mcobind(g)} = \mcobind(\comp{\cobind(f)}{g})$ .
  \end{packitem}

\end{definition}

\begin{definition}[Morphism of comodules]\label{def:morphism_of_comodules}
 %TODO: morphism of comodules
 
 Let $M, N : \C \to \E$ be comodules over the relative comonad $T : \C \stackrel{F}{\to} \D$.
 A \fat{morphism of comodules} from $M$ to $N$ is given by a family of morphisms 
   \[ \alpha_c:\E(Mc,Nc) \]
 such that for any $c,d:\C_0$ and $f : \D(Tc,Fd)$ one has
 \[   \comp{\mcobind^M(f)}{\alpha_d} = \comp{\alpha_c}{\mcobind^N(f)} \enspace . \]
 
\end{definition}

\begin{remark}[Category of comodules]
 Fix a relative comonad $\T : \C\stackrel{F}{\to}\D$ and a category $\E$.
 Comodules over $T$ towards $\E$ and their morphisms (\Cref{def:morphism_of_comodules}) form a category $\RComod(T,\E)$.
\end{remark}


\begin{definition}[Functoriality for modules over relative comonads]
 Let $M : \RComod(T,\E)$ be a comodule over $T$ towards some category $\E$. For $f : \C(c,d)$ we define
  \[ \mlift^S(f) := \mcobind(\comp{\counit_c}{Ff}) .  \]
  %TODO: functoriality for rel comonads 
\end{definition}



\begin{definition}[Constant comodule]
  Given $e:\E_0$, the function $\C_0\to\E_0$ sending any object of $\C$ to $e$ is equiped with
  the structure of a comodule over $T$.
\end{definition}

%TODO: is not needed
% \begin{definition}[Product comodule]
%  Given two comodules $M,N$ over $T$, then the pointwise product is equiped with the structure of 
%  a comodule over $T$.
% \end{definition}



\begin{remark}[Notation]
 Suppose $\C$ has products. We write $\pr_1(A,B) : A\times B \to A$ and $\pr_2(A,B) : A\times B \to B$.
\end{remark}

\begin{definition}[Strong monoidal functor]
 A functor $F:\C\to\D$ between categories with products is \fat{strong monoidal} if we have a family of isomorphisms
  \[ \alpha_{A,B} : F(A\times B) \stackrel{\sim}{\to} FA\times FB\enspace . \] 
\end{definition}


\begin{definition}
 Suppose $F : \C\to \D$ is a strong monoidal functor, i.e.\ we have a family of isomorphisms
  \[ \alpha_{A,B} : F(A\times B) \to FA\times FB\enspace . \] 
  Let $T$ be a relative comonad over $F$, and let $E : \C$ be an object of $\C$.
 We define
 \begin{align*} \extend_{A,B} : \D(TA,FB) &\to \D\bigl(T(E\times A),F(E\times B)\bigr)\\
                                   f   &\mapsto \comp{\bigl\langle \comp{\counit_{E\times A}}{\comp{\alpha_{E,A}}{\pr_1(FE,FA)}}, \comp{\lift(\pr_2(E,A))}{f} \bigr\rangle}{\alpha_{E,B}^{-1}} \enspace .
\end{align*}
% with 
% \begin{align*}
%                \cut_A: \C(T(E\times A), TA), \quad \cut_A := \cobind_{E \times A, A}(\comp{\counit_{E \times A}}{\pr_1}) \enspace .
% \end{align*}



\end{definition}



\begin{definition}[Product in context]\label{def:product_in_context}
 Suppose $\C$ has binary products.
 Given a comodule $M$ over $T$ and an object $E:\C_0$, then precomposition with \enquote{product with $E$}
 gives a comodule $M(E\times\_)$ over $T$.
 
 The comodule operation is deduced from that of $M$ by 
 \begin{align*} \mcobind^{M(E\times\_)}_{A,B} : \C(TA,B)&\to \C(M(E\times A), M(E\times B)) \enspace ,\\
                                                      f &\mapsto \mcobind^M_{E\times A,E\times B}(\extend(f)) \enspace .
  \end{align*}                                        

 \noindent
 Furthermore, given two comodules $M$ and $N$ over $\T$ with target category $\E$, and a comodule morphism $\alpha : M \to N$, then 
 we can define a comodule morphism \[\alpha(E\times \_) : M(E\times \_) \to N(E\times \_) \] by setting
          \[ \alpha(E \times \_)_A := \alpha_{E\times A} \enspace . \]
  
  \noindent
  We thus obtain an endofunctor on the category of comodules over $T$ towards $\E$,
   \[  \_ (E\times \_) : \RComod(T,\E) \to \RComod(T,\E) \enspace . \]
 

\end{definition}

% \begin{definition}[Identity comodule]
% 
%   WRONG, it isn't 
%   
%   i don't delete this yet
% 
%  %TODO: identity comodule (i.e. identity functor forms a comodule over any relative comonad
%  
%  %
%  
% \end{definition}





\begin{example}
 The destructor \lstinline!tail! is a morphism of comodules from the comodule $A \mapsto T(A)$ to $A\mapsto T(E\times A)$.
\end{example}


\begin{definition}[Morphism of relative comonads]
 Let $T$ and $S$ be comonads relative to a functor $F : \C \to \D$. A \fat{morphism of relative comonads} $\tau : T \to S$
  is given by a family of morphisms \[\tau_c : \D(Tc,Sc)\] such that for any $c : \C_0$,
     \[  \counit^T_c = \comp{\tau_c}{\counit^S_c} \]
   and for any $c,d : \C_0$ and $f : \D(Sc,Fd)$,
   \[  \comp{\cobind^T(\comp{\tau_c}{f})}{\tau_d} = \comp{\tau_c}{\cobind^S(f)} \enspace .  \]
\end{definition}

\begin{remark}[Category of relative comonads]
 Fix a functor $F : \C\to\D$. Relative comonads over $F$ and their morphisms form a category.
\end{remark}


\begin{definition}[Pullback comodule]\label{def:pullback_comodule}
  Let $\tau : T\to S$ be a morphism of comonads relative to a functor $F : \C \to \D$, and let furthermore $M$ be a 
  comodule over $S$ towards a category $\E$. We define the \fat{pullback comodule} $\tau^*M$ to be the comodule over $T$ given by
  \[  \tau^*M(c) := Mc \]
  and 
   \[ \mcobind^{\tau^*M}(f) := \mcobind^M(\comp{\tau_c}{f}) \enspace . \]
   
  \noindent
  Pullback is functorial: if $M$ and $N$ are comodules over $S$ with codomain category $\E$, and $\alpha : M\to N$ is 
    a morphism of comodules, then we define \[\tau^*\alpha : \tau^*M \to \tau^*N\] 
    as the family of morphisms
     \[ \tau^*\alpha_c := \alpha_c \enspace . \]
\end{definition}

\begin{definition}[Morphism of comonads induces morphism of comodules]
  Let $\tau : T\to S$ be a morphism of comonads relative to a functor $F : \C \to \D$.
  Then $\tau$ gives rise to a morphism of comodules over $T$ from the tautological comodule
  of $T$ to the pullback along $\tau$ of the tautological comodule over $S$,
  \[ \tau : T \to \tau^*S \enspace . \]
\end{definition}


\begin{remark}\label{rem:prod_pullback_commute}
 Note that the constructions of \Cref{def:product_in_context} and \Cref{def:pullback_comodule} commute in the sense that
 we have an isomorphism of comodules \[\tau^*(M(E\times \_)) \cong (\tau^*M)(E \times \_) \enspace . \]
\end{remark}



\begin{example}[Final semantics for triangular matrices]\label{ex:final_sem_tri}
   Let $\mathcal{T}$ be the category where an object is a pair $(T,t)$ of a relative comonad $T$ over the functor
   $\eq: \Set \to \Setoid$ together with a morphism of comodules $t : T \to T(E \times \_)$.
   A morphism $\tau : (T,t) \to (S,s)$ is given by a morphism of relative comonads $\tau : T \to S$ such that
   the following diagram of comodule morphisms commutes,
   
   \[     \comp{t}{\tau(E\times \_)} = \comp{\tau}{s} \enspace , \]
   i.e.\, diagrammatically,   
   \[ \begin{xy}
       \xymatrix{   T  \ar[r]^t \ar[d]_{\tau}  &  **[r]T (E\times \_ )\ar[d]^{\tau(E\times \_)} \\
                    \tau^*S  \ar[r]_{\tau^*s}  &  **[r] \tau^*S (E\times \_ )
        }
      \end{xy}
   \]

   \noindent
   Here in the lower right corner we silently insert an isomorphism as in \Cref{rem:prod_pullback_commute}.
   
\end{example}


\printbibliography

\end{document}
